version: '3.3'

networks:
  default:
    external:
      name: qwerty

services:
  drone-runner:
    image: drone/drone-runner-docker:1.6.3
    container_name: drone-runner
    ports:
      - '5081:3000'
    environment:
      - 'DRONE_RPC_PROTO=http'
      - 'DRONE_RPC_HOST=drone:80'
      - 'DRONE_RPC_SECRET=ff51a441fa9f4423b47c7580b39b9f4b'
      - 'DRONE_RUNNER_CAPACITY=2'
      - 'DRONE_RUNNER_NAME=docker-runner'
      - 'TZ=Asia/Shanghai'
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock'
    depends_on:
      - drone
    links:
      - drone
    restart: unless-stopped
  drone:
    image: drone/drone:2.0.1
    container_name: drone
    ports:
      - '5080:80'
      - '5443:443'
    environment:
      - 'DRONE_AGENTS_ENABLED=true'
      - 'DRONE_GOGS_SERVER=http://gogs:3000'
      - 'DRONE_RPC_SECRET=ff51a441fa9f4423b47c7580b39b9f4b'
      - 'DRONE_SERVER_HOST=drone:80'
      - 'DRONE_SERVER_PROTO=http'
      - 'TZ=Asia/Shanghai'
    volumes:
      - '$PWD/data:/data'
    restart: unless-stopped
